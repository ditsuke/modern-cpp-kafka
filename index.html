
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>About the *Modern C++ Kafka API*</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.0/css/bootstrap.min.css" integrity="sha384-SI27wrMjH3ZZ89r4o+fGIJtnzkAnFs3E4qz9DIYioCQ5l9Rd/7UAa8DHcaL8jkWt" crossorigin="anonymous">
    <style>
      pre { background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; padding: 0.6em 1em; }
      h1,h2 { margin-top: 1em; }
      div.navbar { padding: 8px 0; }
      div.toc { float: right; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 id="about-the-modern-c-kafka-api"><a class="toclink" href="#about-the-modern-c-kafka-api">About the <em>Modern C++ Kafka API</em></a></h1>
<p><img alt="Lifecycle Active" src="https://badgen.net/badge/Lifecycle/Active/green" />  </p>
<p>The <a href="http://opensource.morganstanley.com/modern-cpp-kafka/doxygen/annotated.html">modern-cpp-kafka API</a> is a layer of <strong><em>C++</em></strong> wrapper based on <a href="https://github.com/confluentinc/librdkafka">librdkafka</a> (the <strong><em>C</em></strong> part only), with high quality, but more friendly to users.</p>
<ul>
<li>By now, <a href="https://github.com/morganstanley/modern-cpp-kafka">modern-cpp-kafka</a> is compatible with <a href="https://github.com/confluentinc/librdkafka/releases/tag/v1.9.2">librdkafka v1.9.2</a>.</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">KAFKA</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">registered</span><span class="w"> </span><span class="n">trademark</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Apache</span><span class="w"> </span><span class="n">Software</span><span class="w"> </span><span class="n">Foundation</span><span class="w"> </span><span class="k">and</span><span class="w"></span>

<span class="n">has</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">licensed</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">modern</span><span class="o">-</span><span class="n">cpp</span><span class="o">-</span><span class="n">kafka</span><span class="p">.</span><span class="w"> </span><span class="n">modern</span><span class="o">-</span><span class="n">cpp</span><span class="o">-</span><span class="n">kafka</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">no</span><span class="w"></span>

<span class="n">affiliation</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">endorsed</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Apache</span><span class="w"> </span><span class="n">Software</span><span class="w"> </span><span class="n">Foundation</span><span class="p">.</span><span class="w"></span>
</code></pre></div>

<h2 id="why-its-here"><a class="toclink" href="#why-its-here">Why it's here</a></h2>
<p>The <strong><em>librdkafka</em></strong> is a robust high performance C/C++ library, widely used and well maintained.</p>
<p>Unfortunately, to maintain <strong><em>C++98</em></strong> compatibility, the <strong><em>C++</em></strong> interface of <strong><em>librdkafka</em></strong> is not quite object-oriented or user-friendly.</p>
<p>Since C++ is evolving quickly, we want to take advantage of new C++ features, thus make the life easier for developers. And this led us to create a new C++ API for Kafka clients.</p>
<p>Eventually, we worked out the <strong><em>modern-cpp-kafka</em></strong>, -- a <strong><em>header-only</em></strong> library that uses idiomatic <strong><em>C++</em></strong> features to provide a safe, efficient and easy to use way of producing and consuming Kafka messages.</p>
<h2 id="features"><a class="toclink" href="#features">Features</a></h2>
<ul>
<li>
<p><strong>Header-only</strong></p>
<ul>
<li>Easy to deploy, and no extra library required to link</li>
</ul>
</li>
<li>
<p><strong>Ease of Use</strong></p>
<ul>
<li>
<p>Interface/Naming matches the Java API</p>
</li>
<li>
<p>Object-oriented</p>
</li>
<li>
<p>RAII is used for lifetime management</p>
</li>
<li>
<p><strong><em>librdkafka</em></strong>'s polling and queue management is now hidden</p>
</li>
</ul>
</li>
<li>
<p><strong>Robust</strong></p>
<ul>
<li>
<p>Verified with kinds of test cases, which cover many abnormal scenarios (edge cases)</p>
<ul>
<li>
<p>Stability test with unstable brokers</p>
</li>
<li>
<p>Memory leak check for failed client with in-flight messages</p>
</li>
<li>
<p>Client failure and taking over, etc.</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Efficient</strong></p>
<ul>
<li>
<p>No extra performance cost (No deep copy introduced internally)</p>
</li>
<li>
<p>Much better (2~4 times throughput) performance result than those native language (Java/Scala) implementation, in most commonly used cases (message size: 256 B ~ 2 KB)</p>
</li>
</ul>
</li>
</ul>
<h2 id="installation-requirements"><a class="toclink" href="#installation-requirements">Installation / Requirements</a></h2>
<ul>
<li>
<p>Just include the <a href="https://github.com/morganstanley/modern-cpp-kafka/tree/main/include/kafka"><code>include/kafka</code></a> directory for your project</p>
</li>
<li>
<p>The compiler should support <strong><em>C++17</em></strong></p>
<ul>
<li>
<p>Or, <strong><em>C++14</em></strong>, but with pre-requirements</p>
<ul>
<li>
<p>Need <strong><em>boost</em></strong> headers (for <code>boost::optional</code>)</p>
</li>
<li>
<p>For <strong><em>GCC</em></strong> compiler, it needs optimization options (e.g. <code>-O2</code>)</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Dependencies</p>
<ul>
<li>
<p><a href="https://github.com/confluentinc/librdkafka"><strong>librdkafka</strong></a> headers and library (only the C part)</p>
<ul>
<li>Also see the <a href="https://github.com/confluentinc/librdkafka#requirements">requirements from <strong>librdkafka</strong></a></li>
</ul>
</li>
<li>
<p><a href="https://github.com/Tencent/rapidjson"><strong>rapidjson</strong></a> headers: only required by <code>addons/KafkaMetrics.h</code></p>
</li>
</ul>
</li>
</ul>
<h2 id="to-start"><a class="toclink" href="#to-start">To Start</a></h2>
<ul>
<li>
<p>Tutorials</p>
<ul>
<li>
<p>Confluent Blog <a href="https://www.confluent.io/blog/modern-cpp-kafka-api-for-safe-easy-messaging">Debuting a Modern C++ API for Apache Kafka</a></p>
<ul>
<li>Noteï¼š it's a bit out of date, since <a href="https://github.com/morganstanley/modern-cpp-kafka/releases">the API changed from time to time</a></li>
</ul>
</li>
<li>
<p><a href="markdown/KafkaProducerQuickStart.html">KafkaProducer Quick Start</a></p>
</li>
<li>
<p><a href="markdown/KafkaConsumerQuickStart.html">KafkaConsumer Quick Start</a></p>
</li>
</ul>
</li>
<li>
<p>User Manual</p>
<ul>
<li>
<p><a href="http://opensource.morganstanley.com/modern-cpp-kafka/doxygen/annotated.html">Kafka Client API</a></p>
</li>
<li>
<p>About <a href="http://opensource.morganstanley.com/modern-cpp-kafka/doxygen/classKAFKA__API_1_1Properties.html"><code>Properties</code></a></p>
<ul>
<li>
<p>It is a map which contains all configuration info needed to initialize a Kafka client.</p>
</li>
<li>
<p>The configuration items are <strong><em>key-value</em></strong> pairs, -- the type of <strong><em>key</em></strong> is always <code>std::string</code>, while the type for a <strong><em>value</em></strong> could be one of the followings</p>
<ul>
<li>
<p><code>std::string</code></p>
<ul>
<li>
<p>Most items are identical with <a href="https://github.com/confluentinc/librdkafka/blob/master/CONFIGURATION.md">librdkafka configuration</a></p>
</li>
<li>
<p>But with exceptions</p>
<ul>
<li>
<p>Default value changes</p>
<p>| Key String  | Default       | Description                                               |</p>
<p>| ----------- | ------------- | --------------------------------------------------------- |</p>
<p>| <code>log_level</code> | <code>5</code>           | Default was <code>6</code> from <strong>librdkafka</strong>                       |</p>
<p>| <code>client.id</code> | random string | No default from <strong>librdkafka</strong>                            |</p>
<p>| <code>group.id</code>  | random string | (for <code>KafkaConsumer</code> only) No default from <strong>librdkafka</strong> | </p>
</li>
<li>
<p>Additional options</p>
<p>| Key String                  | Default       | Description                                                                                         |</p>
<p>| --------------------------- | ------------- | --------------------------------------------------------------------------------------------------- |</p>
<p>| <code>enable.manual.events.poll</code> | <code>false</code>       | To poll the (offset-commit/message-delivery callback) events manually                               |</p>
<p>| <code>max.poll.records</code>          | <code>500</code>         | (for <code>KafkaConsumer</code> only) The maxmum number of records that a single call to <code>poll()</code> would return |</p>
</li>
<li>
<p>Ignored options</p>
<p>| Key String                  | Explanation                                                                        |</p>
<p>| --------------------------- | ---------------------------------------------------------------------------------- |</p>
<p>| <code>enable.auto.offset.store</code>  | <strong><em>modern-cpp-kafka</em></strong> will save the offsets in its own way                        |</p>
<p>| <code>auto.commit.interval.ms</code>   | <strong><em>modern-cpp-kafka</em></strong> will only commit the offsets within each <code>poll()</code> operation |</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>std::function&lt;...&gt;</code></p>
<p>| Key String                     | Value Type                                                                                    |</p>
<p>| ------------------------------ | --------------------------------------------------------------------------------------------- |</p>
<p>| <code>log_cb</code>                       | <code>LogCallback</code> (<code>std::function&lt;void(int, const char*, int, const char* msg)&gt;</code>)                 |</p>
<p>| <code>error_cb</code>                     | <code>ErrorCallback</code> (<code>std::function&lt;void(const Error&amp;)&gt;</code>)                                         |</p>
<p>| <code>stats_cb</code>                     | <code>StatsCallback</code> (<code>std::function&lt;void(const std::string&amp;)&gt;</code>)                                   |</p>
<p>| <code>oauthbearer_token_refresh_cb</code> | <code>OauthbearerTokenRefreshCallback</code> (<code>std::function&lt;SaslOauthbearerToken(const std::string&amp;)&gt;</code>) |</p>
</li>
<li>
<p><code>Interceptors</code></p>
<p>| Key String     | Value Type     |</p>
<p>| -------------- | -------------- |</p>
<p>| <code>interceptors</code> | <code>Interceptors</code> |</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="for-developers"><a class="toclink" href="#for-developers">For Developers</a></h2>
<h3 id="build-for-teststoolsexamples"><a class="toclink" href="#build-for-teststoolsexamples">Build (for <a href="https://github.com/morganstanley/modern-cpp-kafka/tree/main/tests">tests</a>/<a href="https://github.com/morganstanley/modern-cpp-kafka/tree/main/tools">tools</a>/<a href="https://github.com/morganstanley/modern-cpp-kafka/tree/main/examples">examples</a>)</a></h3>
<ul>
<li>
<p>Specify library locations with environment variables</p>
<p>| Environment Variable             | Description                                              | </p>
<p>| -------------------------------- | -------------------------------------------------------- |</p>
<p>| <code>LIBRDKAFKA_INCLUDE_DIR</code>         | <strong><em>librdkafka</em></strong> headers                                 |</p>
<p>| <code>LIBRDKAFKA_LIBRARY_DIR</code>         | <strong><em>librdkafka</em></strong> libraries                               |</p>
<p>| <code>GTEST_ROOT</code>                     | <strong><em>googletest</em></strong> headers and libraries                   |</p>
<p>| <code>BOOST_ROOT</code>                     | <strong><em>boost</em></strong> headers and libraries                        |</p>
<p>| <code>SASL_LIBRARYDIR</code>/<code>SASL_LIBRARY</code> | [optional] for SASL connection support                    |</p>
<p>| <code>RAPIDJSON_INCLUDE_DIRS</code>         | <code>addons/KafkaMetrics.h</code> requires <strong><em>rapidjson</em></strong> headers |</p>
</li>
<li>
<p>Build commands</p>
<ul>
<li>
<p><code>cd empty-folder-for-build</code></p>
</li>
<li>
<p><code>cmake path-to-project-root</code></p>
</li>
<li>
<p><code>make</code> (following options could be used with <code>-D</code>)</p>
<p>| Build Option                     | Description                                                   |</p>
<p>| -------------------------------- | ------------------------------------------------------------- |</p>
<p>| <code>BUILD_OPTION_USE_TSAN=ON</code>       | Use Thread Sanitizer                                          |</p>
<p>| <code>BUILD_OPTION_USE_ASAN=ON</code>       | Use Address Sanitizer                                         |</p>
<p>| <code>BUILD_OPTION_USE_UBSAN=ON</code>      | Use Undefined Behavior Sanitizer                              |</p>
<p>| <code>BUILD_OPTION_CLANG_TIDY=ON</code>     | Enable clang-tidy checking                                    |</p>
<p>| <code>BUILD_OPTION_GEN_DOC=ON</code>        | Generate documentation as well                                |</p>
<p>| <code>BUILD_OPTION_DOC_ONLY=ON</code>       | Only generate documentation                                   |</p>
<p>| <code>BUILD_OPTION_GEN_COVERAGE=ON</code>   | Generate test coverage, only support by clang currently       |</p>
</li>
<li>
<p><code>make install</code> (to install <code>tools</code>)</p>
</li>
</ul>
</li>
</ul>
<h3 id="run-tests"><a class="toclink" href="#run-tests">Run Tests</a></h3>
<ul>
<li>
<p>Kafka cluster setup</p>
<ul>
<li>
<p><a href="https://kafka.apache.org/documentation/#quickstart">Quick Start For Cluster Setup</a></p>
</li>
<li>
<p><a href="https://github.com/morganstanley/modern-cpp-kafka/blob/main/scripts/start-local-kafka-cluster.py">Cluster Setup Scripts For Test</a></p>
</li>
<li>
<p><a href="markdown/KafkaBrokerConfiguration.html">Kafka Broker Configuration</a></p>
</li>
</ul>
</li>
<li>
<p>To run the binary, the test runner requires following environment variables</p>
<p>| Environment Variable               | Descrioption                                                | Example                                                                    |</p>
<p>| ---------------------------------- | ----------------------------------------------------------- | -------------------------------------------------------------------------- |</p>
<p>| <code>KAFKA_BROKER_LIST</code>                | The broker list for the Kafka cluster                       | <code>export KAFKA_BROKER_LIST=127.0.0.1:29091,127.0.0.1:29092,127.0.0.1:29093</code> |</p>
<p>| <code>KAFKA_BROKER_PIDS</code>                | The broker PIDs for test runner to manipulate               | <code>export KAFKA_BROKER_PIDS=61567,61569,61571</code>                               |</p>
<p>| <code>KAFKA_CLIENT_ADDITIONAL_SETTINGS</code> | Could be used for addtional configuration for Kafka clients | <code>export KAFKA_CLIENT_ADDITIONAL_SETTINGS="security.protocol=SASL_PLAINTEXT;sasl.kerberos.service.name=...;sasl.kerberos.keytab=...;sasl.kerberos.principal=..."</code> |</p>
<ul>
<li>
<p>The environment variable <code>KAFKA_BROKER_LIST</code> is mandatory for integration/robustness test</p>
</li>
<li>
<p>The environment variable <code>KAFKA_BROKER_PIDS</code> is mandatory for robustness test</p>
</li>
</ul>
<p>| Test Type                                                                                          | Requires Kafka Cluster   | Requires Privilege to Stop/Resume the Brokers |</p>
<p>| -------------------------------------------------------------------------------------------------- | ------------------------ | --------------------------------------------- |</p>
<p>| <a href="https://github.com/morganstanley/modern-cpp-kafka/tree/main/tests/unit">tests/unit</a>               | -                        | -                                             |</p>
<p>| <a href="https://github.com/morganstanley/modern-cpp-kafka/tree/main/tests/integration">tests/integration</a> | Y (<code>KAFKA_BROKER_LIST</code>)  | -                                             | </p>
<p>| [tests/robustness<code>](https://github.com/morganstanley/modern-cpp-kafka/tree/main/tests/robustness)  | Y (</code>KAFKA_BROKER_LIST<code>)  | Y (</code>KAFKA_BROKER_PIDS`)                       |</p>
</li>
</ul>
      <hr/>
      <footer class="text-center text-muted">
        Generated: 2023. 01. 05
      </footer>
      <hr/>
    </div>
  </body>
</html>